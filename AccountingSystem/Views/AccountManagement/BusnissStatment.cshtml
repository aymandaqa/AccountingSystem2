@using Newtonsoft.Json
@using System.Collections.Generic

@{
    var rtl = true;
    ViewData["Title"] = "حساب العميل";
}


<style>
    .action-toolbar {
        display: flex;
        flex-wrap: wrap;
        align-items: center;
        gap: 0.75rem;
        padding: 0.5rem 0;
    }

        .action-toolbar .btn {
            min-width: 110px;
            box-shadow: 0 4px 10px rgba(29, 191, 193, 0.2);
            border-radius: 6px;
        }

    .summary-card {
        display: flex;
        flex-wrap: wrap;
        gap: 1.5rem;
        align-items: center;
        background: #f6fbfb;
        border: 1px solid rgba(29, 191, 193, 0.15);
        border-radius: 12px;
        padding: 1rem 1.5rem;
        margin-bottom: 1rem;
        color: #0b5d60;
        box-shadow: 0 6px 16px rgba(15, 76, 92, 0.08);
    }

        .summary-card .summary-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 15px;
        }

        .summary-card .summary-label {
            font-weight: 600;
        }

        .summary-card .summary-value {
            font-weight: 700;
            color: #0d1b2a;
            min-width: 60px;
            text-align: start;
        }

    .loading-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.55);
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        z-index: 2000;
        backdrop-filter: blur(3px);
    }

        .loading-overlay.hidden {
            display: none;
        }

        .loading-overlay .spinner {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            border: 5px solid rgba(255, 255, 255, 0.35);
            border-top-color: #1dbfc1;
            animation: spin 1s linear infinite;
        }

        .loading-overlay .loading-text {
            margin-top: 1rem;
            font-size: 1.2rem;
            color: #fff;
            font-weight: 600;
            letter-spacing: 0.5px;
        }

    .no-scroll {
        overflow: hidden !important;
    }

    @@keyframes spin {
        to {
            transform: rotate(360deg);
        }
    }

    #default_dialog.e-dialog .e-dlg-content {
        padding: 0;
        background-color: #f5f7fa;
    }

    #detailstab section.content {
        margin: 0;
    }
</style>

<div class="container-full">


    <!-- Main content -->
    <section class="content" id="mains">
        <div class="row">
            <div class="col-12">
                <div class="box">
                    <div class="box-body">
                        <div class="col-12" id="bodytarg2">
                            <div class="action-toolbar">
                                <button class="btn btn-primary btn-sm" id="Excel" onclick="ExportExcel()">  <i class="ti-layout"></i> اكسل</button>
                                <button class="btn btn-primary btn-sm" onclick="print()" id="Print">  <i class="ti-printer"></i> طباعة</button>

                                <button class="btn btn-primary btn-sm" id="pay" onclick="pay()">  <i class="ti-money"></i> دفع</button>

                                <button class="btn btn-primary btn-sm" id="reload" onclick="Refresh()">  <i class="ti-reload"></i> تحديث</button>
                            </div>
                        </div>
                        <div class="col-12" id="bodytarg2">
                            <div class="summary-card">
                                <div class="summary-item">
                                    <span class="summary-label">عدد الطرود:</span>
                                    <span class="summary-value" id="shipRetCount"></span>
                                </div>
                                <div class="summary-item">
                                    <span class="summary-label">مجموع العمولة:</span>
                                    <span class="summary-value" id="commSum"></span>
                                </div>
                                <div class="summary-item">
                                    <span class="summary-label">مجموع العمولات الاضافية:</span>
                                    <span class="summary-value" id="ExtraFees"></span>
                                </div>
                                <div class="summary-item">
                                    <span class="summary-label">مجموع مبالغ الطرود:</span>
                                    <span class="summary-value" id="shipTotSum"></span>
                                </div>
                                <div class="summary-item">
                                    <span class="summary-label">المبلغ المدفوع:</span>
                                    <span class="summary-value" id="PaidAmountFromShipmentFees"></span>
                                </div>
                                <div class="summary-item">
                                    <span class="summary-label">الصافي:</span>
                                    <span class="summary-value" id="total"></span>
                                </div>
                            </div>
                        </div>
                        <div class="col=md-12">
                            <div class="row">
                                @*  <div class="col-xs-6 col-sm-4">
                                <ejs-dropdownlist id="City" name="Driver" Query="new ej.data.Query()"
                                allowFiltering="true" dataSource="@ViewBag.Driver" placeholder="السائق" change="GetDriverStmt">
                                <e-dropdownlist-fields text="FirstName" value="Id"></e-dropdownlist-fields>
                                </ejs-dropdownlist>
                                </div>    </div>*@
                                <div class="col-xs-6 col-sm-3">
                                    <ejs-dropdownlist id="CompanyBranches" name="CompanyBranches" Query="new ej.data.Query()"
                                                      allowFiltering="true" dataSource="@ViewBag.CompanyBranches" placeholder="الفرع" change="GetBus">


                                        <e-dropdownlist-fields text="BranchName" value="Id"></e-dropdownlist-fields>
                                    </ejs-dropdownlist>
                                </div>
                                <div class="col-xs-6 col-sm-3">
                                    <ejs-dropdownlist id="User" name="User" Query="new ej.data.Query()"
                                                      allowFiltering="true" placeholder="العميل" change="GetuserStmt">
                                        <e-data-manager adaptor="UrlAdaptor" url="/AccountManagement/GetBusnissUser/"></e-data-manager>
                                        <e-dropdownlist-fields text="Name" value="Id"></e-dropdownlist-fields>
                                    </ejs-dropdownlist>
                                </div>
                                <div class="col-xs-6 col-sm-3">
                                    <ejs-dropdownlist id="UserM" name="UserM" Query="new ej.data.Query()"
                                                      allowFiltering="true" placeholder="المسوق" change="GetuserStmt2">
                                        <e-data-manager adaptor="UrlAdaptor" url="/AccountManagement/GetMBusnissUser/"></e-data-manager>
                                        <e-dropdownlist-fields text="Name" value="Id"></e-dropdownlist-fields>
                                    </ejs-dropdownlist>
                                </div>
                                <div class="col-xs-6 col-sm-3">
                                    <ejs-dropdownlist id="InvoiceStatus" name="InvoiceStatus" Query="new ej.data.Query()"
                                                      allowFiltering="true" dataSource="@ViewBag.Driver" placeholder="السائق">
                                        <e-dropdownlist-fields text="Name" value="Id"></e-dropdownlist-fields>
                                    </ejs-dropdownlist>
                                </div>

                            </div>
                            <ejs-grid id="Grid" allowFiltering="true" gridLines="Both" enableRtl="@rtl" allowPaging="false" allowSorting="true" allowFiltering="true"
                                      width="100%"
                                      allowExcelExport="true" allowPdfExport="true"
                                      enableStickyHeader="true" height="400px" allowTextWrap="true" recordClick="recordClick"
                                      allowSelection="true" rowSelected="rowSelected">
                                <e-data-manager url="/AccountManagement/UrlDatasourceBusnissStatment" adaptor="UrlAdaptor"></e-data-manager>
                                <e-grid-filterSettings type="Menu"></e-grid-filterSettings>
                                <e-grid-aggregates>
                                    <e-grid-aggregate>
                                        <e-aggregate-columns>
                                            <e-aggregate-column field="ShipmentTrackingNo" type="Count" footerTemplate="عدد الشحنات:(${Count})"></e-aggregate-column>
                                            <e-aggregate-column field="ShipmentTotal" type="Sum" footerTemplate="مجموع الشحنات:(${Sum})"></e-aggregate-column>
                                            <e-aggregate-column field="ShipmentPrice" type="Sum" footerTemplate="مجموع سعر الشحنات:(${Sum})"></e-aggregate-column>
                                            <e-aggregate-column field="ShipmentFees" type="Sum" footerTemplate="مجموع عمولة الشحنات:(${Sum})"></e-aggregate-column>
                                            <e-aggregate-column field="ShipmentExtraFees" type="Sum" footerTemplate="مجموع العمولات الاضافية للشحنات:(${Sum})"></e-aggregate-column>
                                        </e-aggregate-columns>
                                    </e-grid-aggregate>
                                </e-grid-aggregates>
                                <e-grid-columns>
                                    <e-grid-column type="checkbox" width="50"></e-grid-column>

                                    <e-grid-column field="Id" headerText="Id" allowEditing="false" Visible="false" isPrimaryKey="true"></e-grid-column>
                                    <e-grid-column field="BusinessUserId" headerText="BusinessUserId" allowEditing="false" Visible="false"></e-grid-column>
                                    @*<e-grid-column field="CityCode" headerText="City Code" width="120"></e-grid-column>*@
                                    <e-grid-column field="ShipmentTrackingNo" headerText="رقم التتبع" width="120" template="#ShipmentTrackingNo"></e-grid-column>
                                    <e-grid-column field="IUser" headerText="المدخل/المسوق" width="120"></e-grid-column>
                                    <e-grid-column field="ShipmentContains" headerText="محتويات الشحنة" width="120"></e-grid-column>
                                    <e-grid-column field="EntryDateTime" format="dd/MM/yyyy hh:mm" type="date" headerText="تاريخ الادخال" width="120"></e-grid-column>
                                    <e-grid-column field="ToCity" headerText="المدينة" width="120"></e-grid-column>
                                    <e-grid-column field="AreaName" headerText="المنطقة" width="120"></e-grid-column>
                                    <e-grid-column field="ShipmentTotal" headerText="المجموع الكلي" width="120"></e-grid-column>
                                    <e-grid-column field="ShipmentPrice" headerText="سعر الشحنة" width="120"></e-grid-column>
                                    <e-grid-column field="PaidAmountFromShipmentFees" headerText="المبلغ المدفوع" width="120"></e-grid-column>

                                    <e-grid-column field="ShipmentFees" headerText="عمولة الشحنة" width="120"></e-grid-column>
                                    <e-grid-column field="ShipmentExtraFees" headerText="عمولات الشحنة الاضافية" width="120"></e-grid-column>
                                </e-grid-columns>
                            </ejs-grid>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <!-- /.content -->

</div>

<div id="pageOverlay" class="loading-overlay hidden">
    <div class="spinner"></div>
    <div class="loading-text">جاري معالجة الدفع...</div>
</div>

@{
    var defaultanimation = new Syncfusion.EJ2.Popups.DialogAnimationSettings { Effect = Syncfusion.EJ2.Popups.DialogEffect.Fade };
    var resizeDirectionHandles = new List<string>() { "All" };
}
<ejs-dialog id="default_dialog"
            allowDragging="false" isModal="true"
            resizeHandles="resizeDirectionHandles"
            enableResize="true" created="onCreated"
            animationSettings="defaultanimation"
            width="80%" target="#mains"
            open="dialogOpen"
            close="dialogClose"
            showCloseIcon="true"
            header="تفاصيل الشحنة">
    <e-content-template>
        <div>
            <div id='detailstab'></div>
        </div>
    </e-content-template>

</ejs-dialog>

<script type="text/x-jsrender" id="ShipmentTrackingNo">
    <div id="${ShipmentTrackingNo}" class="statustemp" style="color:#6610f2;font-weight: bold;" data-id="${Id}" data-tracking="${ShipmentTrackingNo}">
        <button class="btn btn-primary btn-sm" type="button">${ShipmentTrackingNo}</button>
    </div>
</script>

<script>
    function dialogClose() {
    }

    function dialogOpen() {
    }

    function onCreated() {
        var dialogObj = document.getElementById("default_dialog").ej2_instances[0];
        dialogObj.hide();
    }

    function Shipdetails(sss, el) {
        dialogClose();
        var dialogElement = document.getElementById("default_dialog");
        var dialogObj = dialogElement.ej2_instances[0];
        var trackingLabel = el && el.dataset ? el.dataset.tracking : (el && el.id ? el.id : el);
        dialogObj.header = "تفاصيل الشحنة " + (trackingLabel || "");
        dialogObj.show();
        var ajax = new ej.base.Ajax('/Shipments/Update?Id=' + sss, 'GET', true);
        ajax.send().then();
        ajax.onSuccess = function (data) {
            $("#detailstab").html(data);
        };
    }

    $(document).on('click', '.statustemp', function () {
        var element = this;
        var shipmentId = element.dataset ? element.dataset.id : null;
        if (!shipmentId) {
            return;
        }

        Shipdetails(shipmentId, element);
    });

    function onfiltering(e) {
        var query = new ej.data.Query();
        query = (e.text !== '') ? query.where('Name', 'contains', e.text, true) : query;
        e.updateData(@Html.Raw(JsonConvert.SerializeObject(ViewBag.data)), query);
    }
    function showLoadingOverlay() {
        var overlay = document.getElementById('pageOverlay');
        if (overlay) {
            overlay.classList.remove('hidden');
            document.body.classList.add('no-scroll');
        }
    }
    function hideLoadingOverlay() {
        var overlay = document.getElementById('pageOverlay');
        if (overlay) {
            overlay.classList.add('hidden');
            document.body.classList.remove('no-scroll');
        }
    }
    function GetuserStmt() {
        var User = document.getElementById('User').ej2_instances[0];
        var grid1 = document.getElementById('Grid').ej2_instances[0]; // Grid instance

            var UserM = document.getElementById('UserM').ej2_instances[0]; // Grid instance
             UserM.value = null;
             UserM.dataSource = new ej.data.DataManager({
                url: '/AccountManagement/GetMBusnissUser?user=' + User.value,
                adaptor: new ej.data.UrlAdaptor()
            });



        grid1.dataSource = new ej.data.DataManager({
            url: '/AccountManagement/UrlDatasourceBusnissStatment?userId=' + User.value,
            adaptor: new ej.data.UrlAdaptor()
        });
        //$.ajax({
        //    type: "Get",
        //    url: "/Shipments/GetShipmentsTrackingGeneratedCode?UserId="+SenderName.value,
        //    data: ''
        //}).done(function (data) {
        //    var  obj = JSON.parse(JSON.stringify(data));

        //               $("#ShipmentTrackingNo").val(obj["GeneratedCode"]);
        //});

    }

    function GetuserStmt2() {
        var User = document.getElementById('User').ej2_instances[0];
        var grid1 = document.getElementById('Grid').ej2_instances[0]; // Grid instance
      var UserM = document.getElementById('UserM').ej2_instances[0]; // Grid instance



      if(UserM.value==null){

        grid1.dataSource = new ej.data.DataManager({
            url: '/AccountManagement/UrlDatasourceBusnissStatment?userId=' + User.value,
            adaptor: new ej.data.UrlAdaptor()
        });
      }else{

        grid1.dataSource = new ej.data.DataManager({
            url: '/AccountManagement/UrlDatasourceBusnissStatmentM?userId=' + User.value+'&MuserId='+UserM.value,
            adaptor: new ej.data.UrlAdaptor()
        });
      }

        //$.ajax({
        //    type: "Get",
        //    url: "/Shipments/GetShipmentsTrackingGeneratedCode?UserId="+SenderName.value,
        //    data: ''
        //}).done(function (data) {
        //    var  obj = JSON.parse(JSON.stringify(data));

        //               $("#ShipmentTrackingNo").val(obj["GeneratedCode"]);
        //});

    }
    function Refresh() {
        var User = document.getElementById('User').ej2_instances[0];
        var grid1 = document.getElementById('Grid').ej2_instances[0]; // Grid instance
        grid1.dataSource = new ej.data.DataManager({
            url: '/AccountManagement/UrlDatasourceBusnissStatment?userId=' + User.value,
            adaptor: new ej.data.UrlAdaptor()
        });
    }
    function ExportExcel() {
        var grid1 = document.getElementById('Grid').ej2_instances[0]; // Grid instance
        var exceldata = grid1.getSelectedRecords();
        if (exceldata == null) {
            grid1.excelExport();
        } else {
            var exportProperties = {
                dataSource: exceldata
            };
            grid1.excelExport(exportProperties);
        }
    }

    function print() {
        var grid1 = document.getElementById('Grid').ej2_instances[0]; // Grid instance
        grid1.print();
    }
    function pay() {
        var grid = document.getElementById('Grid').ej2_instances[0]; // Grid instance
        var InvoiceStatus = document.getElementById('InvoiceStatus').ej2_instances[0]; // Grid instance
        var selectedRecords = grid.getSelectedRecords();
        if (!selectedRecords || selectedRecords.length === 0) {
            swal("الرجاء اختيار الشحنات المراد دفعها");
            return;
        }
        if (InvoiceStatus.value == null) {
            swal("الرجاء اختيار السائق");
            return;
        }
        swal({
            title: "هل انت متأكد ؟",
            icon: "info",
            buttons: true,
            dangerMode: true,
        })
            .then((willDelete) => {
                if (willDelete) {
                    showLoadingOverlay();
                    document.getElementById("pay").disabled = true;
                     //alert(myJSON);
                    var ajax1 = new ej.base.Ajax({ url: '/AccountManagement/PayToBusniss?dariverID=' + InvoiceStatus.value, data: JSON.stringify(selectedRecords), type: 'POST', contentType: 'application/json' });
                    ajax1.send(JSON.stringify(selectedRecords));
                    ajax1.onSuccess = function (data) {
                        document.getElementById("pay").disabled = false;
                        hideLoadingOverlay();
                        swal(data, {
                            icon: "success",
                        });
                         var grid = document.getElementById("Grid").ej2_instances[0];
                        grid.refresh(); //tabObj.select(0);
                        window.open('/AccountManagement/PrintUserSlip?id=' + JSON.parse(data).Id, '_blank');
                    };
                    ajax1.onFailure = function (data) {
                        hideLoadingOverlay();
                        document.getElementById("pay").disabled = false;
                        swal(data);
                    };
                    ajax1.onError = function (error) {
                        hideLoadingOverlay();
                        document.getElementById("pay").disabled = false;
                        swal(error);
                    };
                } else {
                    //swal("Your imaginary file is safe!");
                }
            });
    }
    function rowSelected(args) {

        var shipRetCount = 0;
        var commSum = 0;
        var shipTotSum = 0;
        var total = 0;
        var PaidAmountFromShipmentFees = 0;
        var ExtraFees = 0;
        $('#shipRetCount').text(shipRetCount);
        $('#commSum').text(commSum);
        $('#shipTotSum').text(shipTotSum);
        $('#total').text(total);
        $('#ExtraFees').text(ExtraFees);
        var grid = document.getElementById("Grid").ej2_instances[0];
        var selectedRecords = grid.getSelectedRecords();
        var ids = "";
        for (var k in selectedRecords) {
            commSum += selectedRecords[k].ShipmentFees;
            shipTotSum += selectedRecords[k].ShipmentTotal;
            ExtraFees += selectedRecords[k].ShipmentExtraFees;
            PaidAmountFromShipmentFees += selectedRecords[k].PaidAmountFromShipmentFees;

        }
        $('#commSum').text(commSum);
        $('#shipRetCount').text(selectedRecords.length);
        $('#shipTotSum').text(shipTotSum);
        var cc=shipTotSum - commSum - ExtraFees;
        if(cc>0){
                    $('#total').text(cc-PaidAmountFromShipmentFees);

        }else{
                                $('#total').text(cc+PaidAmountFromShipmentFees);

        }
                $('#PaidAmountFromShipmentFees').text(PaidAmountFromShipmentFees);

        // $('#total').text(shipTotSum - commSum - ExtraFees);
        $('#ExtraFees').text(ExtraFees);
    }


    function GetBus() {

        var User = document.getElementById('User').ej2_instances[0]; // Grid instance
        User.value = null;
        var CompanyBranches = document.getElementById('CompanyBranches').ej2_instances[0]; // Grid instance
        User.dataSource = new ej.data.DataManager({
            url: '/AccountManagement/GetBusnissUser?branchId=' + CompanyBranches.value,
            adaptor: new ej.data.UrlAdaptor()
        });
    }


    function recordClick() {


        timeout = setTimeout(alertFunc, 500);

    }

    function alertFunc() {
        var shipRetCount = 0;
        var commSum = 0;
        var shipTotSum = 0;
        var total = 0;
        var ExtraFees = 0;
                var PaidAmountFromShipmentFees = 0;

        $('#shipRetCount').text(shipRetCount);
        $('#commSum').text(commSum);
        $('#shipTotSum').text(shipTotSum);
        $('#total').text(total);
        $('#ExtraFees').text(ExtraFees);
        var grid = document.getElementById("Grid").ej2_instances[0];
        var selectedRecords = grid.getSelectedRecords();
        var ids = "";
        for (var k in selectedRecords) {
            commSum += selectedRecords[k].ShipmentFees;
            shipTotSum += selectedRecords[k].ShipmentTotal;
            ExtraFees += selectedRecords[k].ShipmentExtraFees;
                        PaidAmountFromShipmentFees += selectedRecords[k].PaidAmountFromShipmentFees;

        }
        $('#commSum').text(commSum);
        $('#shipRetCount').text(selectedRecords.length);
        $('#shipTotSum').text(shipTotSum);
    var cc=shipTotSum - commSum - ExtraFees;
           if(cc>0){
                       $('#total').text(cc-PaidAmountFromShipmentFees);

           }else{
                                   $('#total').text(cc+PaidAmountFromShipmentFees);

           }
                   $('#PaidAmountFromShipmentFees').text(PaidAmountFromShipmentFees);

           // $('#total').text(shipTotSum - commSum - ExtraFees);
                $('#ExtraFees').text(ExtraFees);
    }
       function UpdateShColorStatus(shId,statusid,shipmentNo) {


           var ajax1 = new ej.base.Ajax({ url: '/Shipments/UpdateShColorStatus?Id='+shId+'&statusId='+statusid, data: '', type: 'POST', contentType: 'application/json' });
                        ajax1.send();
                        ajax1.onSuccess = function (data) {
                             // alert('Shipment number copied to clipboard!');
                                var toasts = [{ title: 'Success!', content: shipmentNo + ' تم تغير لون الشحنة الشحنه', cssClass: 'e-toast-success', icon: 'e-success toast-icons' }];
                                alertObj.show(toasts[0]);
                        };
                        ajax1.onFailure = function (data) {
                            swal('Error');
                        };



    }
    function UpdateShExtraFees(shId) {
        var ShipmentExtraFees=$("#ShipmentExtraFees").val();

           var ajax1 = new ej.base.Ajax({ url: '/Shipments/UpdateShExtraFees?Id='+shId+'&ExtraFees='+ShipmentExtraFees, data: '', type: 'POST', contentType: 'application/json' });
                        ajax1.send();
                        ajax1.onSuccess = function (data) {
                             // alert('Shipment number copied to clipboard!');
                                var toasts = [{ title: 'Success!', content:   data, cssClass: 'e-toast-success', icon: 'e-success toast-icons' }];
                                alertObj.show(toasts[0]);
                        };
                        ajax1.on = function (data) {
                             var toasts = [
                            { title: 'Error!', content: data, cssClass: 'e-toast-danger', icon: 'e-error toast-icons' }];
                        alertObj.show(toasts[0]);
                        };
                        ajax1.onFailure = function (data) {

                             var toasts = [
                            { title: 'Error!', content: data, cssClass: 'e-toast-danger', icon: 'e-error toast-icons' }];
                        alertObj.show(toasts[0]);

                        };



    }


     function statechange() {
        var city = document.getElementById('ClientCityID').ej2_instances[0];
        var Area = document.getElementById('ClientAreaID').ej2_instances[0];
        Area.enabled = true;
        //Query the data source based on state DropDownList selected value
        var tempQuery = new ej.data.Query().where('CityId', 'equal', city.value);
        //set the framed query based on selected value in city DropDownList.
        Area.query = tempQuery;
        //clear the existing selection
        Area.text = null;
        //bind the property change to city DropDownList
        Area.dataBind();
        GetShipmentFee();
    }
    function GetTrkingNo() {
        var SenderName = document.getElementById('SenderName').ej2_instances[0];
        $.ajax({
            type: "Get",
            url: "/Shipments/GetShipmentsTrackingGeneratedCode?UserId=" + SenderName.value,
            data: ''
        }).done(function (data) {
            var obj = JSON.parse(JSON.stringify(data));

            $("#ShipmentTrackingNo").val(obj["GeneratedCode"]);
        });
        GetShipmentFee();
    }
    function GetAlert() {
        var ShipmentTypeID = document.getElementById('ShipmentTypeID').ej2_instances[0];
        $.ajax({
            type: "Get",
            url: "/Shipments/GetAlert?ShipmentTypeId=" + ShipmentTypeID.value,
            data: ''
        }).done(function (data) {
            var obj = JSON.parse(JSON.stringify(data));
            $("#Alert").val(obj["Alert"]);
        });
    }

    function GetShipmentCount() {
        var x = document.getElementById("ClientPhone");
        var mobile = x.value;
        $.ajax({
            type: "Get",
            url: "/Shipments/GetShipmentByClinteMobile?Mobile=" + mobile,
            data: ''
        }).done(function (data) {
            var obj = JSON.parse(JSON.stringify(data));
            $("#shipDoneCount1").text(obj.ShipmentsTypesClose);
            $("#shipRetCount1").text(obj.ShipmentsTypesRet);
        });
    }
    function GetShipmentFee() {
        var ShipmentTotal = document.getElementById("ShipmentTotal");
        var city = document.getElementById('ClientCityID').ej2_instances[0];
        var SenderName = document.getElementById('SenderName').ej2_instances[0];
        var ShipmentPrice = document.getElementById("ShipmentPrice");
        var ShipmentFees = document.getElementById("ShipmentFees");
        if (city.value == null) {
            swal("الرجاء اختيار المدينة");
            // swal("Here's a message!");
            return;
        }
        if (SenderName.value == null) {
            swal("الرجاء اختيار المرسل");
            return;
        }
        $.ajax({
            type: "Get",
            url: "/Shipments/GetShipmentFee?UserId=" + SenderName.value + "&CityId=" + city.value,
            data: ''
        }).done(function (data) {
            if (data == "NotFound") {
                swal("لا يوجد تسعيرة شحن");
                $("#ShipmentExtraFees").val("0");
                $("#ShipmentFees").val("0");
                $("#ShipmentExtraFeesq").val("1");
                $("#rangeVal").text("1");
                $("#ShipmentPrice").val("");
            } else {
                var obj = JSON.parse(JSON.stringify(data));
                $("#ShipmentFees").val("0");
                $("#ShipmentExtraFeesq").val("1");
                $("#ShipmentExtraFees").val("0");
                $("#rangeVal").text("1");
                $("#ShipmentPrice").val("");

                $("#ShipmentFees").val(obj.Fees);
                $("#ShipmentPrice").val($("#ShipmentTotal").val() - obj.Fees);
            }
        });
    }
    function GetShipmentExtFee() {


        var ShipmentFees = $("#ShipmentFees").val();
        var ShipmentExtraFeesq = $("#ShipmentExtraFeesq").val();
        var ShipmentTotal = $("#ShipmentTotal").val();
        var total = ShipmentFees * ShipmentExtraFeesq;
        total = total - ShipmentFees;
        $("#ShipmentExtraFees").val(total);
        ShipmentPrice = ShipmentTotal - ShipmentFees - parseFloat($("#ShipmentExtraFees").val());
        $("#ShipmentPrice").val(ShipmentPrice);
    }



    function GetShipmentExtFee2() {
        var ShipmentFees = $("#ShipmentFees").val();
        var ShipmentTotal = $("#ShipmentTotal").val();
        ShipmentPrice = ShipmentTotal - ShipmentFees - parseFloat($("#ShipmentExtraFees").val());
        $("#ShipmentPrice").val(ShipmentPrice);
        //$("#ShipmentTotal").val(parseFloat(ShipmentFees)+parseFloat(ShipmentPrice));
    }
    function updateshipment() {
        GetShipmentExtFee2();
        if ($("#updateShipmentForm").valid()) {
            var data = $("#updateShipmentForm").serialize();
            //console.log(data);
            //alert(data);
            $.ajax({
                type: 'POST',
                url: '/Shipments/update',
                contentType: 'application/x-www-form-urlencoded; charset=UTF-8', // when we use .serialize() this generates the data in query string format. this needs the default contentType (default content type is: contentType: 'application/x-www-form-urlencoded; charset=UTF-8') so it is optional, you can remove it
                data: data,
                success: function (result) {
                    swal(result, { icon: "success", });
                    console.log(result);
                },
                error: function (data) {
                    swal(data, { icon: "error", });
                    console.log('Failed ');
                }
            })
        }
    }

</script>