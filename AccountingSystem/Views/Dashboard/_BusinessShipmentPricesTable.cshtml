@using System.Globalization
@using System.Linq
@model IReadOnlyList<AccountingSystem.ViewModels.BusinessShipmentPriceViewModel>

@{
    var culture = CultureInfo.CreateSpecificCulture("ar-SA");
    Func<decimal, string> formatCurrency = value => string.Format(culture, "{0:N2}", value);
}

@if (Model == null || !Model.Any())
{
    <div class="alert alert-info text-center mb-0">
        لا توجد شحنات أعمال مسجلة حالياً.
    </div>
}
else
{
    var branch = Model.First();
    var branchId = branch.BranchId;
    var totalShipmentPrice = Model.Sum(s => s.ShipmentPrice);

    <div class="table-responsive">
        <div class="d-flex align-items-center justify-content-between flex-wrap gap-2 mb-3">
            <div>
                <div class="fw-semibold">تفاصيل فرع: @branch.BranchName</div>
                @if (branchId.HasValue)
                {
                    <div class="text-muted small">معرّف الفرع: @branchId</div>
                }
                else if (branch.CompanyBranchId.HasValue)
                {
                    <div class="text-muted small">معرّف Road: @branch.CompanyBranchId</div>
                }
            </div>
            <div class="text-end">
                <div class="text-muted small">عدد الشحنات: @Model.Count</div>
                <div class="fw-semibold">@formatCurrency(totalShipmentPrice)</div>
            </div>
        </div>
        <table class="table table-sm table-hover align-middle mb-0">
            <thead class="table-light">
                <tr>
                    <th scope="col">رقم التتبع</th>
                    <th scope="col">العميل التجاري</th>
                    <th scope="col">العميل النهائي</th>
                    <th scope="col">الفرع</th>
                    <th scope="col" class="text-end">سعر الشحنة</th>
                    <th scope="col">الحالة</th>
                    <th scope="col">تاريخ الإدخال</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var shipment in Model)
                {
                    <tr>
                        <td>
                            <div class="fw-semibold">@shipment.ShipmentTrackingNo</div>
                            @if (shipment.ShipmentId.HasValue)
                            {
                                <div class="text-muted small">@shipment.ShipmentId</div>
                            }
                        </td>
                        <td>
                            <div class="fw-semibold">@shipment.BusinessName</div>
                            @if (shipment.BusinessId.HasValue)
                            {
                                <div class="text-muted small">معرّف: @shipment.BusinessId</div>
                            }
                        </td>
                        <td>
                            <div class="fw-semibold">@shipment.ClientName</div>
                            @if (!string.IsNullOrWhiteSpace(shipment.CityName) || !string.IsNullOrWhiteSpace(shipment.AreaName))
                            {
                                <div class="text-muted small">@string.Join(" - ", new[] { shipment.CityName, shipment.AreaName }.Where(x => !string.IsNullOrWhiteSpace(x)))</div>
                            }
                        </td>
                        <td>
                            <div class="fw-semibold">@shipment.BranchName</div>
                            @if (shipment.CompanyBranchId.HasValue)
                            {
                                <div class="text-muted small">@("#" + shipment.CompanyBranchId)</div>
                            }
                        </td>
                        <td class="text-end">
                            <span class="fw-semibold">@formatCurrency(shipment.ShipmentPrice)</span>
                        </td>
                        <td>
                            <span class="badge bg-secondary-subtle text-secondary">@(!string.IsNullOrWhiteSpace(shipment.Status) ? shipment.Status : "غير محدد")</span>
                        </td>
                        <td>
                            @if (shipment.EntryDate.HasValue)
                            {
                                <div class="fw-semibold">@shipment.EntryDate.Value.ToString("dd/MM/yyyy")</div>
                                <div class="text-muted small">@shipment.EntryDate.Value.ToString("HH:mm")</div>
                            }
                            else
                            {
                                <span class="text-muted">غير متاح</span>
                            }
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
}
